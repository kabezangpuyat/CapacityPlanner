@model WFMPCP.Model.Web.ManagerUserView
@{
	ViewBag.Title = "WFMPCP | User Manager";
	//Layout = "~/Views/Shared/_Layout.cshtml";
}
@section specificPluginStyles{
<link rel="stylesheet" href="@Url.Content( "~/assets/css/jquery-ui.min.css" )" />
<link rel="stylesheet" href="@Url.Content( "~/assets/css/bootstrap-datepicker3.min.css" )" />
<link rel="stylesheet" href="@Url.Content( "~/assets/css/ui.jqgrid.min.css" )" />
}

<div class="row">
    <!-- PAGE CONTENT BEGINS -->
    <div class="col-xs-12 col-lg-6">
        <div>
            <table id="grid-table"></table>

            <div id="grid-pager"></div> 
        </div>
    </div>

    <div class="col-xs-12 col-lg-6">
        <div class="panel-group" style="width:100%; margin-left:10px; margin-right: 10px;">
            <div class="panel panel-primary">
                <div class="panel-heading" style="font-weight:bolder; font-size:12px;">User Details</div>
                <div class="panel-body">
                    <div class="container-fluid">
                        <div class="row" style="margin-top:5px; margin-bottom:5px;">
                            <div class="col-sm-5" style="width:30%;"><span class="txtbold">User Level :</span></div>
                            <div class="col-sm-pull-5">
                                <input id="txtUserId" type="text" value="0" style="display:none;"/>
                                <select class="form-control" id="ddlUserLevels" style="width:200px;">
                                    <option value="0">All</option>
                                    @foreach( var u in Model.UserLevels )
                                    {
                                        <option value="@u">@u</option>
                                    }                                    
                                </select>
                            </div>
                        </div>
                        <div class="row" style="margin-top:5px; margin-bottom:5px;">
                            <div class="col-sm-5" style="width:30%;"><span class="txtbold">User :</span></div>
                            <div class="col-sm-pull-5">
                                <select class="form-control" id="ddlUsers" style="width:300px;">
                                    <option value="0">Select User</option>
                                    @if( Model.UsersVM != null )
                                    {
                                        foreach( var user in Model.UsersVM )
                                        {
                                            <option value="@user.EmployeeID">@user.FullName</option>
                                        }
                                    }                                    
                                </select>
                            </div>
                        </div>
                        <div class="row" style="margin-top:5px; margin-bottom:5px;">
                            <div class="col-sm-5" style="width:30%;"><span class="txtbold">Role :</span></div>
                            <div class="col-sm-pull-5">
                                <select class="form-control" id="ddlRoles" style="width:300px;">
                                    <option value="0">Select Role</option>
                                    @if( Model.RoleVM != null )
                                    {
                                        foreach( var role in Model.RoleVM )
                                        {
                                            <option value="@role.ID">@role.Name</option>
                                        }
                                    }
                                </select>
                            </div>
                        </div>
                        <div class="row" style="margin-top:5px; margin-bottom:5px; display:none;">
                            <div class="col-sm-5" style="width:30%;"><span class="txtbold">Status :</span></div>
                            <div class="col-sm-pull-5">
                                <select class="form-control" id="ddlStatus" style="width:200px;">
                                    <option value="-1">Select Status</option>
                                    <option value="0">Inactive</option>
                                    <option value="1">Active</option>
                                </select>
                            </div>
                        </div>
                        <div class="row" style="margin-top:5px; margin-bottom:5px;">
                            <div class="col-sm-pull-5">
                                <div align="left">
                                    &nbsp;&nbsp;&nbsp;
                                    @*<input type="button" value="" id="btnSave" class="btn btn-info" />*@
                                    <button id="btnSave" class="btn btn-sm btn-primary">
                                        <i class="ace-icon fa fa-check"></i>
                                        Save
                                    </button>
                                    &nbsp;
                                    <button id="btnDelete" class="btn btn-sm btn-primary" style="display:none;">
                                        <i class="ace-icon fa fa-times"></i>
                                        Delete
                                    </button>
                                    &nbsp;
                                    <button id="btnCancel" class="btn btn-sm" data-dismiss="modal">
                                        <i class="ace-icon fa fa-times"></i>
                                        Cancel
                                    </button>
                                    @*<input type="button" value="" id="btnDelete" class="btnDelete" style="display:none;" />*@
                                    &nbsp;
                                   @* <input type="button" value="" id="btnCancel" class="btnCancel" />*@
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- PAGE CONTENT ENDS -->
    <!-- /.col -->
</div><!-- /.row -->
@section specificScripts{
<script src="@Url.Content("~/assets/js/bootstrap-datepicker.min.js")"></script>
<script src="@Url.Content("~/assets/js/jquery.jqGrid.min.js")"></script>
<script src="@Url.Content("~/assets/js/grid.locale-en.js")"></script>  
<script src="@Url.Content("~/Scripts/pageJs/UserManagement.js")"></script>  
}

@section scripts{

    <script>
        var grid_selector = "#grid-table";
        var pager_selector = "#grid-pager";
        $(document).ready(function () {

            var jqDataUrl = "@Url.Action("LoadjqData", "UserManagement" )";
            // Set up the jquery grid

            var parent_column = $(grid_selector).closest('[class*="col-"]');
            //resize to fit page size
            $(window).on('resize.jqGrid', function () {
                $(grid_selector).jqGrid('setGridWidth', parent_column.width());
            })

            //resize on sidebar collapse/expand
            $(document).on('settings.ace.jqGrid', function (ev, event_name, collapsed) {
                if (event_name === 'sidebar_collapsed' || event_name === 'main_container_fixed') {
                    //setTimeout is for webkit only to give time for DOM changes and then redraw!!!
                    setTimeout(function () {
                        $(grid_selector).jqGrid('setGridWidth', parent_column.width());
                    }, 20);
                }
            })


            jQuery(grid_selector).jqGrid({
                //direction: "rtl",

                //subgrid options
                subGrid: false,
                //data: grid_data,
                //datatype: "local",
                height: 500,
                width: 600,

                url: jqDataUrl,
                datatype: "json",
                mtype: "POST",

                colNames: ["ID", "Full Name", "Employee ID", "User Level", "Status","Role"],
                // Configure the columns
                colModel: [
                    { name: "ID", index: "ID", width: 5, align: "center", hidden: true },
                    { name: "FullName", index: "FullName", width: 30, align: "center" },
                    { name: "EmployeeID", index: "EmployeeID", width: 35, align: "center" },
                    { name: "UserLevel", index: "UserLevel", width: 35, align: "center" },
                    { name: "Field1", index: "Field1", width: 35, align: "center" },
                    { name: "RoleName", index: "RoleName", width: 35, align: "center" }
                ],
                //cursor:"pointer",
                viewrecords: true,
                rowNum: 20,
                //rowList: [20,40,60],
                pager: pager_selector,
                altRows: true,
                //toppager: true,

                multiselect: false,
                //multikey: "ctrlKey",
                multiboxonly: true,

                //editurl: "./dummy.php",//nothing is saved
                caption: "User Manager",
                sortname: "FullName,EmployeeID,UserLevel", //Column name of entity to be sort
                sortorder: "asc",
                loadComplete: function () {
                    var table = this;
                    setTimeout(function () {
                        //styleCheckbox(table);

                        common.UpdateJQGridPagerIcons(table);
                        //align column header  to center
                        $('.ui-jqgrid-sortable').attr('style', 'text-align: center;');
                        //common.EnableJQGridTootTips(table);
                    }, 0);
                },
                onSelectRow: function (id) {
                    userManagement.OnGridSelectRow(id, '@Url.Action( "LoadDetails", "UserManagement" )');
                }

            });
            $(window).triggerHandler('resize.jqGrid');
            //navButtons
            //jQuery(grid_selector).jqGrid({"sortgrid","FullName","Asc"});
            jQuery(grid_selector).jqGrid('navGrid', pager_selector,
                { 	//navbar options
                    edit: false,
                    //editicon: 'ace-icon fa fa-pencil blue',
                    add: false,
                    //addicon: 'ace-icon fa fa-plus-circle purple',
                    del: false,
                    delicon: 'ace-icon fa fa-trash-o red',
                    search: true,
                    searchicon: 'ace-icon fa fa-search orange',
                    refresh: true,
                    refreshicon: 'ace-icon fa fa-refresh green',
                    view: false
                    //viewicon: 'ace-icon fa fa-search-plus grey',
                },
                {}, // settings for edit
                {}, // settings for add
                {
                    //onClick: function (e) {
                    //    alert(e);
                    //}
                }, // settings for delete
                {
                    sopt: ["cn", "eq"],
                    caption: "Search...",
                    Find: "Search",
                    closeAfterSearch: true
                }
            );

            ////replace icons with FontAwesome icons like above
            //function updatePagerIcons(table) {
            //    var replacement =
            //    {
            //        'ui-icon-seek-first': 'ace-icon fa fa-angle-double-left bigger-140',
            //        'ui-icon-seek-prev': 'ace-icon fa fa-angle-left bigger-140',
            //        'ui-icon-seek-next': 'ace-icon fa fa-angle-right bigger-140',
            //        'ui-icon-seek-end': 'ace-icon fa fa-angle-double-right bigger-140'
            //    };
            //    $('.ui-pg-table:not(.navtable) > tbody > tr > .ui-pg-button > .ui-icon').each(function () {
            //        var icon = $(this);
            //        var $class = $.trim(icon.attr('class').replace('ui-icon', ''));

            //        if ($class in replacement) icon.attr('class', 'ui-icon ' + replacement[$class]);
            //    })
            //}

            //function enableTooltips(table) {
            //    $('.navtable .ui-pg-button').tooltip({ container: 'body' });
            //    $(table).find('.ui-pg-div').tooltip({ container: 'body' });
            //}

            //var selr = jQuery(grid_selector).jqGrid('getGridParam','selrow');

            $(document).one('ajaxloadstart.page', function (e) {
                $.jgrid.gridDestroy(grid_selector);
                $('.ui-jqdialog').remove();
            });
        });

        userManagement.OnUserLevelChange('@Url.Action("GetAllUsers","UserManagement")');
        userManagement.OnSaveClick('@Url.Action( "Save", "UserManagement")', grid_selector, '@Url.Action("GetAllUsers","UserManagement")');
        userManagement.OnCancel('@Url.Action("GetAllUsers","UserManagement")');
    </script>
}



